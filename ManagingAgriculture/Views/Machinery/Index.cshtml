@model IEnumerable<ManagingAgriculture.Models.Machinery>
@{
    ViewData["Title"] = "Machinery Management";
}

<div class="machinery-container">
    <div class="page-header">
        <div>
            <p class="subtitle">Track equipment and maintenance schedules</p>
        </div>
    </div>
    <div class="machinery-grid">
        @foreach (var machinery in Model)
        {
            <!-- Determine status badge style -->
            string statusClass = machinery.Status switch
            {
                "Excellent" => "excellent",
                "Good" => "good",
                "Fair" => "fair",
                "Poor" => "poor",
                _ => "unknown"
            };

            <!-- Determine days until next service -->
            int daysUntilService = machinery.NextServiceDate.HasValue ? (int)(machinery.NextServiceDate.Value - DateTime.Now).TotalDays : 0;
            string serviceUrgency = daysUntilService < 0 ? "Overdue!" : daysUntilService == 0 ? "Today" : $"In {daysUntilService} days";
            string urgencyClass = daysUntilService < 0 ? "urgency-overdue" : daysUntilService < 7 ? "urgency-soon" : "urgency-normal";

            <div class="machinery-card">
                <div class="machinery-header">
                    <div class="machinery-title">
                        <i class="fas fa-tractor machinery-icon"></i>
                        <div>
                            <h3>@machinery.Name</h3>
                            <span class="machinery-type">@machinery.Type</span>
                        </div>
                    </div>
                    <span class="status-badge @statusClass">@machinery.Status</span>
                </div>
                <div class="machinery-info-row">
                    <div>
                        <span class="info-label">Purchase Date</span>
                        <span class="info-value">@(machinery.PurchaseDate?.ToShortDateString() ?? "N/A")</span>
                    </div>
                    <div>
                        <span class="info-label">Last Service</span>
                        <span class="info-value">@(machinery.LastServiceDate?.ToShortDateString() ?? "N/A")</span>
                    </div>
                    <div>
                        <span class="info-label">Engine Hours</span>
                        <span class="info-value">@((machinery.EngineHours.HasValue ? machinery.EngineHours.Value.ToString("N1") : "0.0")) h</span>
                    </div>
                </div>
                <div class="next-service-box @urgencyClass">
                    <i class="fas fa-calendar"></i>
                    <div>
                        <span class="service-label">Next Service</span>
                        <span class="service-date">@(machinery.NextServiceDate?.ToShortDateString() ?? "N/A")</span>
                        <span class="service-days">@serviceUrgency</span>
                    </div>
                </div>
                <div class="machinery-actions">
                    <a href="@Url.Action("Edit", "Machinery", new { id = machinery.Id })" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                    <form method="post" action="@Url.Action("Delete", "Machinery")" style="display: inline-block;">
                        <input type="hidden" name="id" value="@machinery.Id" />
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </form>
                </div>
            </div>
        }
    </div>
</div>
