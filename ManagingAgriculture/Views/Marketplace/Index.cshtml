@using System.Linq
@model IEnumerable<ManagingAgriculture.Models.MarketplaceListing>
@{
    ViewData["Title"] = "Marketplace";
}

<div class="marketplace-container">
    <div class="page-header">
        <div>
            <p class="subtitle">Buy, sell, or rent farm equipment</p>
        </div>
    </div>

    <div class="marketplace-filters">
        <form class="d-flex gap-2" onsubmit="return false;">
            <input type="text" name="q" value="@(ViewBag.Query ?? "")" class="marketplace-search form-control" placeholder="Search equipment..." />
            @{
                var selectedCat = (ViewBag.SelectedCategory as string) ?? "All";
            }
            <select name="category" class="marketplace-category form-select">
                @if (selectedCat == "All")
                {
                    <option value="All" selected>All</option>
                }
                else
                {
                    <option value="All">All</option>
                }

                @{
                    var cats = (ViewBag.Categories as IEnumerable<string>) ?? Enumerable.Empty<string>();
                    var extras = new[] { "Parts", "Tools" };
                    foreach (var c in cats.Union(extras))
                    {
                        if (selectedCat == c)
                        {
                            <option value="@c" selected>@c</option>
                        }
                        else
                        {
                            <option value="@c">@c</option>
                        }
                    }
                }
            </select>
            <button type="submit" class="btn btn-outline-secondary">Filter</button>
        </form>
    </div>

    <div id="marketplace-grid">
        @await Html.PartialAsync("_Grid", (object)Model)
    </div>
</div>
